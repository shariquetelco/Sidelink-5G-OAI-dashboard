<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OAI 5G Sidelink Tactical Monitor - IABG Research Grade</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tactical.css') }}">
    
    <!-- Chart.js for real-time graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Mermaid.js for sequence diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <img src="{{ url_for('static', filename='images/IABG_Logo.png') }}" alt="IABG Logo" class="logo">
            <div class="header-title">
                <h1>üõ°Ô∏è SIDELINK 5G TACTICAL DASHBOARD - IABG</h1>
                <div class="subtitle">Mission: Device-to-Device Tactical Communications (Mode 2) - Research Grade</div>
            </div>
        </div>
        <div class="header-right">
            <div class="classified-badge">[CLASSIFIED]</div>
            <button onclick="window.location.href='/api/export/csv'" class="export-btn">üìä Export CSV</button>
        </div>
    </div>

    <!-- Network Topology -->
    <div class="topology-section">
        <h2>NETWORK TOPOLOGY</h2>
        <div class="topology-diagram">
            <div class="ue-box alpha">
                <h3>üî¥ UNIT ALPHA</h3>
                <div>(SyncRef)</div>
            </div>
            <div class="link-arrow">‚óÑ‚îÄ‚îÄ‚îÄ‚îÄSIDELINK‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫<br>Direct PC5</div>
            <div class="ue-box bravo">
                <h3>üîµ UNIT BRAVO</h3>
                <div>(Nearby)</div>
            </div>
        </div>
        <div class="network-status">
            <p id="gnb-status"><span class="status-indicator offline"></span>‚ö†Ô∏è gNB: OFFLINE (Not Required - Autonomous Mode)</p>
            <p id="core-status"><span class="status-indicator offline"></span>‚ö†Ô∏è CORE: OFFLINE (Not Required - Direct Comms)</p>
            <p id="topology-status"><span class="status-indicator online"></span>STATUS: ‚úÖ TACTICAL LINK ESTABLISHED</p>
        </div>
    </div>

    <!-- Link Performance (existing) -->
    <div class="performance-section">
        <h2>üìà LINK PERFORMANCE METRICS</h2>
        <div class="quality-bar-container">
            <label>Overall Link Quality:</label>
            <div class="quality-bar">
                <div id="quality-bar-fill" class="quality-bar-fill" style="width: 100%;">
                    100% ‚úÖ EXCELLENT
                </div>
            </div>
        </div>
        <div class="performance-stats">
            <div class="performance-stat">
                <div class="metric-label">PSSCH Decode Success:</div>
                <div id="pssch-decode" class="metric-value success">0/0 (100.0%)</div>
            </div>
            <div class="performance-stat">
                <div class="metric-label">PSBCH Decode Success:</div>
                <div id="psbch-decode" class="metric-value success">0/0 (100.0%)</div>
            </div>
            <div class="performance-stat">
                <div class="metric-label">Packet Error Rate (PER):</div>
                <div id="packet-error-rate" class="metric-value">0.00%</div>
            </div>
            <div class="performance-stat">
                <div class="metric-label">Throughput:</div>
                <div class="metric-value">~2.5 Mbps (estimated)</div>
            </div>
        </div>
    </div>

    <!-- NEW: Real-Time Throughput Graph -->
    <div class="research-section">
        <h2>üìä RESEARCH METRICS: REAL-TIME THROUGHPUT ANALYSIS</h2>
        <div class="chart-container">
            <canvas id="throughputChart"></canvas>
        </div>
        <div class="chart-info">
            <p>üìå <strong>Analysis:</strong> Bidirectional data flow between Unit Alpha and Unit Bravo. Solid lines = TX, Dashed lines = RX. Update interval: 2 seconds.</p>
        </div>
    </div>

    <!-- NEW: Signal Quality Trends -->
    <div class="research-section">
        <h2>üì° SIGNAL QUALITY TRENDS (UNIT ALPHA)</h2>
        <div class="chart-container">
            <canvas id="signalChart"></canvas>
        </div>
        <div class="chart-info">
            <p>üìå <strong>Metrics:</strong> RSRP = Reference Signal Received Power | SINR = Signal-to-Interference-plus-Noise Ratio | CQI = Channel Quality Indicator (0-15)</p>
        </div>
    </div>

    <!-- NEW: Channel Frequency Response -->
    <div class="research-section">
        <h2>üåä CHANNEL FREQUENCY RESPONSE (SPECTRUM ANALYSIS)</h2>
        <div class="chart-container">
            <canvas id="spectrumChart"></canvas>
        </div>
        <div class="chart-info">
            <p>üìå <strong>Spectrum:</strong> 106 Resource Blocks spanning 2.6 GHz ¬± 53 MHz. Red curve = measured channel response, Gray area = noise floor. Simulated FFT visualization.</p>
        </div>
    </div>

    <!-- UE Cards (existing) -->
    <div class="ue-cards">
        <!-- Unit Alpha (SyncRef UE) -->
        <div class="ue-card alpha">
            <div class="ue-card-header">
                <h3>üî¥ UNIT ALPHA (SyncRef)</h3>
                <span id="syncref-status" class="status-badge operational">‚úÖ OPERATIONAL</span>
            </div>

            <div class="metric-section">
                <h4>üì° RADIO PARAMETERS</h4>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ Carrier:</span>
                    <span id="syncref-carrier" class="metric-value">2.6 GHz</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ Bandwidth:</span>
                    <span id="syncref-bandwidth" class="metric-value">106 RBs</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ MCS:</span>
                    <span id="syncref-mcs" class="metric-value">9</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îî‚îÄ TX Power:</span>
                    <span id="syncref-tx-power" class="metric-value">23 dBm</span>
                </div>
            </div>

            <div class="metric-section">
                <h4>üìä PHY LAYER STATS</h4>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ Frame/Slot:</span>
                    <span id="syncref-frame-slot" class="metric-value">0:0</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ PSBCH TX:</span>
                    <span id="syncref-psbch-tx" class="metric-value success">0 ‚úÖ</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ PSCCH TX:</span>
                    <span id="syncref-pscch-tx" class="metric-value success">0 ‚úÖ</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ PSSCH TX:</span>
                    <span id="syncref-pssch-tx" class="metric-value success">0 ‚úÖ</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ PSFCH TX:</span>
                    <span id="syncref-psfch-tx" class="metric-value">0</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îî‚îÄ Success Rate:</span>
                    <span id="syncref-success-rate" class="metric-value success">100.0%</span>
                </div>
            </div>

            <div class="metric-section">
                <h4>üîê LINK QUALITY</h4>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ RSRP:</span>
                    <span id="syncref-rsrp" class="metric-value">-45 dBm</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ SINR:</span>
                    <span id="syncref-sinr" class="metric-value">25 dB</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ CQI:</span>
                    <span id="syncref-cqi" class="metric-value">15</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îî‚îÄ Decode Errors:</span>
                    <span id="syncref-errors" class="metric-value">0/0</span>
                </div>
            </div>

            <div class="metric-section">
                <h4>üíæ TERMINAL OUTPUT (Live)</h4>
                <div id="syncref-terminal" class="terminal">
                    <div class="terminal-line">Waiting for data...</div>
                </div>
            </div>
        </div>

        <!-- Unit Bravo (Nearby UE) -->
        <div class="ue-card bravo">
            <div class="ue-card-header">
                <h3>üîµ UNIT BRAVO (Nearby UE)</h3>
                <span id="nearby-status" class="status-badge operational">‚úÖ OPERATIONAL</span>
            </div>

            <div class="metric-section">
                <h4>üì° RADIO PARAMETERS</h4>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ Carrier:</span>
                    <span id="nearby-carrier" class="metric-value">2.6 GHz</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ Bandwidth:</span>
                    <span id="nearby-bandwidth" class="metric-value">106 RBs</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ MCS:</span>
                    <span id="nearby-mcs" class="metric-value">9</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ RX Gain:</span>
                    <span id="nearby-rx-gain" class="metric-value">Auto</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îî‚îÄ Synced:</span>
                    <span id="nearby-synced" class="metric-value success">‚úÖ Yes</span>
                </div>
            </div>

            <div class="metric-section">
                <h4>üìä PHY LAYER STATS</h4>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ Frame/Slot:</span>
                    <span id="nearby-frame-slot" class="metric-value">0:0</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ PSBCH RX:</span>
                    <span id="nearby-psbch-rx" class="metric-value success">0 ‚úÖ</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ PSCCH RX:</span>
                    <span id="nearby-pscch-rx" class="metric-value success">0 ‚úÖ</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ PSSCH RX:</span>
                    <span id="nearby-pssch-rx" class="metric-value success">0 ‚úÖ</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ PSFCH TX:</span>
                    <span id="nearby-psfch-tx" class="metric-value">0</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îî‚îÄ Success Rate:</span>
                    <span id="nearby-success-rate" class="metric-value success">100.0%</span>
                </div>
            </div>

            <div class="metric-section">
                <h4>üîê LINK QUALITY</h4>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ RSRP:</span>
                    <span id="nearby-rsrp" class="metric-value">-48 dBm</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ SINR:</span>
                    <span id="nearby-sinr" class="metric-value">24 dB</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îú‚îÄ CQI:</span>
                    <span id="nearby-cqi" class="metric-value">15</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">‚îî‚îÄ Decode Errors:</span>
                    <span id="nearby-errors" class="metric-value">0/0</span>
                </div>
            </div>

            <div class="metric-section">
                <h4>üíæ TERMINAL OUTPUT (Live)</h4>
                <div id="nearby-terminal" class="terminal">
                    <div class="terminal-line">Waiting for data...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Protocol Message Flow Sequence Diagram -->
    <div class="research-section">
        <h2>üîÑ PROTOCOL MESSAGE FLOW (LIVE SEQUENCE DIAGRAM)</h2>
        <div class="sequence-container" id="messageFlowDiagram">
            <pre class="mermaid">
sequenceDiagram
    participant Alpha as üî¥ Unit Alpha<br/>(SyncRef)
    participant Bravo as üîµ Unit Bravo<br/>(Nearby)
    
    Note over Alpha,Bravo: Initializing...
            </pre>
        </div>
        <div class="chart-info">
            <p>üìå <strong>Protocol Flow:</strong> Real-time visualization of sidelink message exchange. PSBCH for synchronization, PSSCH for data, PSFCH for feedback.</p>
        </div>
    </div>

    <!-- Events Log (existing) -->
    <div class="events-section">
        <h2>‚ö° MISSION EVENTS LOG</h2>
        <div id="event-log" class="event-log">
            <div class="event-item">
                <span class="event-time">--:--:--</span>
                Waiting for events...
            </div>
        </div>
    </div>

    <!-- Use Cases (existing) -->
    <div class="usecase-section">
        <h2>üéØ USE CASE: TACTICAL DEFENSE SCENARIOS</h2>
        <div class="usecase-list">
            <div class="usecase-item">‚úì Infantry squad communications (no cell tower needed)</div>
            <div class="usecase-item">‚úì Vehicle-to-vehicle tactical data exchange</div>
            <div class="usecase-item">‚úì Disaster relief operations (infrastructure down)</div>
            <div class="usecase-item">‚úì Border patrol mesh networks</div>
            <div class="usecase-item">‚úì Critical infrastructure monitoring (oil rigs, ports)</div>
            <div class="usecase-item">‚úì Military convoy coordination</div>
        </div>
    </div>

    <!-- Footer -->
    <div style="background: rgba(20, 27, 45, 0.8); border-top: 2px solid var(--accent-blue); padding: 1rem 2rem; margin-top: 2rem; text-align: center; color: var(--text-secondary);">
        <p style="margin: 0; font-size: 0.9rem;">
            Prepared by <strong style="color: var(--accent-blue);">AHMAD SHARIQUE</strong>, IABG CTSF 20 | Research-Grade Monitoring Platform
        </p>
    </div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
